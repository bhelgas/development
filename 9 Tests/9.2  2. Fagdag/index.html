<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.5">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- <header>
    <input type="text" name="" id="userID" placeholder="userID">&nbsp;
    <button>Submit</button>    
    </header> -->
    <main>
        <section>
            <h1 style="color:blue;">
                HumanCreator 2000
                <svg fill="blue" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="512" height="512"><path d="M23.912,20.027l-1.057-5.96a3.477,3.477,0,0,0-1-5.793A10,10,0,0,0,2.226,7.9L1.5,12s1.607,0,1.778-.013a12.2,12.2,0,0,0,4.9-1.191A1.484,1.484,0,0,0,8,11.5a1.5,1.5,0,1,0,1.637-1.484A16.531,16.531,0,0,0,16.121,3.14a7.966,7.966,0,0,1,3.833,6.009l.078.746.738.133A1.5,1.5,0,0,1,20.5,13H19.351l-.22.624C18.214,16.222,15.13,19,12,19a8.358,8.358,0,0,1-7-5H1.147L.065,20.115A3.238,3.238,0,0,0,3.237,24L9,24V20.408A8.2,8.2,0,0,0,12,21a8.218,8.218,0,0,0,3-.591V24h5.762a3.217,3.217,0,0,0,2.56-1.256A3.172,3.172,0,0,0,23.912,20.027Z"/><circle cx="14.5" cy="11.5" r="1.5"/></svg>
            </h1>
            <p style="color:blue">Create your own human with the HumanCreator 2000 </p>
            <br>
            <h4>Personal information</h4>
            <input type="text" name="" id="humanID" placeholder="Human ID">
            <input type="text" name="" id="firstName" placeholder="First name">
            <input type="text" name="" id="lastName" placeholder="Last name"><br>
            <select name="" id="role">
                <option default value="select">-- Select a role --</option>
                <option value="Teachers">Teacher</option>
                <option value="Students">Student</option>
                <option value="IT Staff">IT Staff</option>
                <option value="Admins">Admin</option>
                <option value="IT Medarbeider">IT Medarbeider</option>
            </select>
            <input type="text" name="" id="address" placeholder="Address">
            <input type="text" name="" id="phoneNumber" placeholder="Phone numbers">
            <br><br>
            <h4>Computer information</h4>
            <input type="text" name="" id="computerName" placeholder="Computer name">
            <input type="text" name="" id="computerModel" placeholder="Computer model">
            <br><br>
            <button id="createHumanButton">Create your human!</button>
        </section>
        <section>
            <h1 style="color:green;">
                HumanFinder 5000 
                <svg fill="green" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="512" height="512"><path d="M23.912,20.027l-1.057-5.96a3.477,3.477,0,0,0-1-5.793A10,10,0,0,0,2.226,7.9L1.5,12s1.607,0,1.778-.013a12.2,12.2,0,0,0,4.9-1.191A1.484,1.484,0,0,0,8,11.5a1.5,1.5,0,1,0,1.637-1.484A16.531,16.531,0,0,0,16.121,3.14a7.966,7.966,0,0,1,3.833,6.009l.078.746.738.133A1.5,1.5,0,0,1,20.5,13H19.351l-.22.624C18.214,16.222,15.13,19,12,19a8.358,8.358,0,0,1-7-5H1.147L.065,20.115A3.238,3.238,0,0,0,3.237,24L9,24V20.408A8.2,8.2,0,0,0,12,21a8.218,8.218,0,0,0,3-.591V24h5.762a3.217,3.217,0,0,0,2.56-1.256A3.172,3.172,0,0,0,23.912,20.027Z"/><circle cx="14.5" cy="11.5" r="1.5"/></svg>
            </h1>
            <p style="color: green">
                Unable to find your human information? Use HumanFinder 5000!
            </p><br>
            <h4>Human ID</h4>
            <input type="text" name="" id="FINDER_humanID" placeholder="HumanID"><br><br>
            <button id="findHumanButton">Find with humanID</button>
            <p id="humanInformation">
                
            
            </p>
        </section>
        <section>
            <h1 style="color:red;">
                HumanEliminator 80000
                <svg fill="red" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="512" height="512"><path d="M23.912,20.027l-1.057-5.96a3.477,3.477,0,0,0-1-5.793A10,10,0,0,0,2.226,7.9L1.5,12s1.607,0,1.778-.013a12.2,12.2,0,0,0,4.9-1.191A1.484,1.484,0,0,0,8,11.5a1.5,1.5,0,1,0,1.637-1.484A16.531,16.531,0,0,0,16.121,3.14a7.966,7.966,0,0,1,3.833,6.009l.078.746.738.133A1.5,1.5,0,0,1,20.5,13H19.351l-.22.624C18.214,16.222,15.13,19,12,19a8.358,8.358,0,0,1-7-5H1.147L.065,20.115A3.238,3.238,0,0,0,3.237,24L9,24V20.408A8.2,8.2,0,0,0,12,21a8.218,8.218,0,0,0,3-.591V24h5.762a3.217,3.217,0,0,0,2.56-1.256A3.172,3.172,0,0,0,23.912,20.027Z"/><circle cx="14.5" cy="11.5" r="1.5"/></svg>
            </h1>
            <p style="color: red">
                Sick and tired of your human? Eliminate it with a simple press of a button!
            </p><br>
            <h4>Human ID</h4>
            <input type="text" name="" id="ELIMINATE_humanID" placeholder="HumanID">
            <input type="text" name="" id="ELIMINATE_humanID_confirm" placeholder="Confirm HumanID"><br><br>
            <button id="eliminateHumanButton">Eliminate human</button>
        </section>

        <input type="text" id="HumanID_login"" placeholder="Log in with your Human ID"><a id="showRole">No role</a>
    </main>


    <script type="module">
        // Import javascript from google. 
        import { initializeApp } 
        from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";

        import { getFirestore, addDoc, collection,doc, setDoc, getDoc, getDocs, deleteDoc } 
        from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
                  /*We don't do this shit around here*/
        };
        // Initialise firebase and its config
        const app = initializeApp(firebaseConfig);
        const db = getFirestore();

        // Check if DOM content is loaded before it runs the code inside
        // this clears up some issues where it requires the ID of content
        document.addEventListener("DOMContentLoaded", () => {
            // Declaration of variables
            var HumanID_login = document.querySelector("#HumanID_login");
            var showRole = document.querySelector("#showRole");
            var humanInformationElement = document.querySelector("#humanInformation");
            var FINDER_humanID = document.querySelector("#FINDER_humanID");
            var FINDER_role = document.querySelector("#FINDER_role");
            var ELIMINATE_humanID = document.querySelector("#ELIMINATE_humanID");
            var ELIMINATE_humanID_confirm = document.querySelector("#ELIMINATE_humanID_confirm");
            var humanID = document.querySelector("#humanID");
            var firstName = document.querySelector("#firstName");
            var lastName = document.querySelector("#lastName");
            var role = document.querySelector("#role");
            var address = document.querySelector("#address");
            var phoneNumber = document.querySelector("#phoneNumber");
            var computerName = document.querySelector("#computerName");
            var computerModel = document.querySelector("#computerModel");
            var createHuman = document.querySelector("#createHumanButton");
            var findHuman = document.querySelector("#findHumanButton");
            var eliminateHuman = document.querySelector("#eliminateHumanButton");

            // "Login field" This event listener always checks the input>
            // >of the user 
            HumanID_login.addEventListener("input", () => {
                // Calling the getUserRole function with the user id>
                // >specified in the input field
                getUserRole(HumanID_login.value);
            })
            // this function gets the value from the code above, it checks the role to the user and adds it to the HTML paragraph
            async function getUserRole(HUMANID) {
                console.log("I am being called");
                const docRef = doc(db, "Humans", HUMANID);
                const docSnap = await getDoc(docRef);
                var SHIT = docSnap.data().role;
                    showRole.innerHTML = `Role: ${SHIT}`
            }
            // Function to delete data from the database
            eliminateHuman.addEventListener("click", async () => {
                if (ELIMINATE_humanID.value == ELIMINATE_humanID_confirm.value) {
                    await deleteDoc(doc(db, "Humans", ELIMINATE_humanID.value));
                } else {
                    alert("Could not delete human. Make sure you have written the same ID in the input fields.")
                }
            });
            // Function to find user in database
            findHuman.addEventListener("click", async ()=> {;
                // Getting the document from ID
                const docSnap = await getDoc(doc(db, "Humans", FINDER_humanID.value));
                // Checking if the document exists
                if(docSnap.exists()) {
                    alert("Data found!" + docSnap.data());
                    humanInformationElement.innerHTML = `
                        <br><br>
                        <table>
                            <tr>
                                <td><b>Username: </b></td>
                                <td>&nbsp;${docSnap.data().userName}</td>
                            </tr>
                            <tr>
                                <td><b>Human ID: </b></td>
                                <td>&nbsp;${docSnap.data().ID}</td>
                            </tr>
                            <tr>
                                <td><b>First name: </b></td>
                                <td>&nbsp;${docSnap.data().firstName}</td>
                            </tr>
                            <tr>
                                <td><b>Last name: </b></td>
                                <td>&nbsp;${docSnap.data().lastName}</td>
                            </tr>
                            <tr>
                                <td><b>Role: </b></td>
                                <td>&nbsp;${docSnap.data().role}</td>
                            </tr>
                            <tr>
                                <td><b>Address: </b></td>
                                <td>&nbsp;${docSnap.data().address}</td>
                            </tr>
                            <tr>
                                <td><b>Phone number: </b></td>
                                <td>&nbsp;${docSnap.data().phoneNumber}</td>
                            </tr>
                        </table>
                        <br>
                    `;
                    // If the logged in user has the correct permission they will get a more detailed view
                    if(showRole.innerHTML == "Role: Admins") {
                        humanInformationElement.innerHTML += `
                            <h4>Computer information</h4>
                            <table>
                                <tr>
                                    <td><b>Computer name: </b></td>
                                    <td>&nbsp;${docSnap.data().computerName}</td>
                                </tr>
                                <tr>
                                    <td><b>Computer model: </b></td>
                                    <td>&nbsp;${docSnap.data().computerModel}</td>
                                </tr>
                            </table>
                        `;
                    }
                }   
                // If the document doesnt exist it gives an alert
                 else {
                    alert("We can not find any humans with this ID")
                }
                
            });
            // Creating a document to add to the database
            createHuman.addEventListener("click", async () => {
                // If the input value from the dropdown menu is empty, they will require to change it
                if(role.value == "-- Select a role --") {
                    console.log("Please select a role to continue");
                    alert("Please select a role to continue");
                } else {
                    // For debuggin we are adding this alert to notify that it is adding a document to the database
                    alert("Adding human to database..");
                    // Adding(/setDoc) a document to the database, with the Path Humans/ID/All Informatio
                    await setDoc(doc(db, "Humans", humanID.value),{
                        userName: firstName.value.slice(0,3) +lastName.value.slice(0,3)+humanID.value,
                        ID: humanID.value,
                        firstName: firstName.value,
                        lastName: lastName.value,
                        role: role.value,
                        address: address.value,
                        phoneNumber: phoneNumber.value,
                        computerName: computerName.value,
                        computerModel: computerModel.value
                    })
                    // Notifying user that their input as been added to the database
                    alert(`Human ${firstName.value} has been added to the database`);
                }
            });
        });
    </script>
</body>
</html>