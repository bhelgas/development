<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }
    </style>
</head>
<body>
    <input type="file" id="selectedFile"><br><br>
    <button id="uploadFile">Upload your file</button><br><br>
    <span id="showFileInfo"></span>

    <script type="module">
        import { initializeApp } 
        from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        
        import { getStorage, ref, uploadBytes, listAll, getDownloadURL, deleteObject } 
        from "https://www.gstatic.com/firebasejs/10.8.1/firebase-storage.js";

        const firebaseConfig = {
                  /*We don't do this shit around here*/
        };
        
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        document.querySelector("#selectedFile").addEventListener('change', () => {
            const file = document.querySelector("#selectedFile").files[0];
            const fileType = file.name.split('.').pop();
            const fileSize = file.size;
            let sizeValue;

            if (fileSize < 1024 * 1024) {
                sizeValue = (fileSize / 1024).toFixed(2) + "KB";
            } else if (fileSize < 1024 * 1024 * 1024) {
                sizeValue = (fileSize / (1024 * 1024)).toFixed(2)  + "MB";
            } else {
                sizeValue = fileSize / (1024 * 1024 * 1024).toFixed(2) + "GB";
            }

            document.querySelector("#showFileInfo").innerHTML = `
            <br>
            <b>File:</b> ${file.name}
            <br>
            <b>File type: </b> ${fileType}
            <br>
            <b>Size:</b> ${sizeValue} / 15MB MAX
            <br>
            <b>Directory:</b> gs://fagdag-utvikling-2.appspot.com/files/${fileType}/${file.name} `
        });
        document.querySelector("#uploadFile").addEventListener('click', async (e) => {
                const file = document.querySelector("#selectedFile").files[0];
                const fileSize = file.size / (1024*1024);
                const fileType = file.name.split('.').pop();
                const imageRef = ref(storage, `files/${fileType}/${file.name}`);
            if(fileSize > 1.5e+7) {
                alert(`File ${file.name} is too big max 15 MB your file is ${sizeValue}. Please upload a smaller file.`);
            } else {
                try {
                    await uploadBytes(imageRef, file);
                    console.log(`File ${file.name} has been uploaded successfully! Size:Â ${fileSize.toFixed(1)} MB`);
                } catch (error) {
                    console.log("Error uploading file: " + error);
                }
            }
        });
    </script>
</body>
</html>