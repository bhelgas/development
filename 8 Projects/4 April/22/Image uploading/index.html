
<!DOCTYPE html>
<html>
<head>
    <title>Image Upload and Comments</title>
    <link rel="stylesheet" href="style.css"> 
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        body {
            background-color: aliceblue;
            font-family: Arial, Helvetica, sans-serif;
        }
        main, header, footer{
            padding: 25px;
        }
        main {
            display: flex;
            gap: 20px;
        }
        main img {
            width: 10rem;
            object-fit: cover;
            aspect-ratio: 1/1;
            border-radius: 5px;
            box-shadow: 0px 0px 0px black;
            border: 2px solid black;
            transition: .4s ease-in-out;
        }
        main img:hover {
            box-shadow: 10px 10px 0px black;
            border: 2px solid black;
        }
        button {
            padding-left: 5px;
            padding-right: 5px;
        }
        footer {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .comment {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- <header>
        <h1 class="largeScale down">Image Gallery</h1>
    </header>
    <section class="fileUpload">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#890a49" fill-opacity="1" d="M0,96L48,90.7C96,85,192,75,288,90.7C384,107,480,149,576,160C672,171,768,149,864,133.3C960,117,1056,107,1152,117.3C1248,128,1344,160,1392,176L1440,192L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>
        <div class="upload">
            <h1 class="largeScale up">Upload an image</h1>
            <input type="file" id="imageUpload" accept="image/*">
            <button id="uploadButton">Upload</button>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#890a49" fill-opacity="1" d="M0,256L40,240C80,224,160,192,240,197.3C320,203,400,245,480,234.7C560,224,640,160,720,133.3C800,107,880,117,960,112C1040,107,1120,85,1200,117.3C1280,149,1360,235,1400,277.3L1440,320L1440,320L1400,320C1360,320,1280,320,1200,320C1120,320,1040,320,960,320C880,320,800,320,720,320C640,320,560,320,480,320C400,320,320,320,240,320C160,320,80,320,40,320L0,320Z"></path></svg>
    </section>
    <main id="imagesContainer">
    </main>
    <div id="addComment"></div> -->


    <header>    
        <h2>Upload <b>your</b> personal image</h2><br>
        <input type="file" id="imageUpload" accept="image/*">
        <button id="uploadButton">Upload</button>
    </header>

    <main id="imagesContainer">
    </main>

    <footer>
        <h1>Comments</h1>
        <div class="comment">
            <input type="text" placeholder="Write a comment" id="commentInput">
            <button id="addComment">Submit comment</button>
        </div>
        <div id="commentContainer">

        </div>
    </footer>





    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
        import { getStorage, uploadBytes, getDownloadURL, ref } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-storage.js";
        import { getFirestore, addDoc, getDoc, setDoc, arrayUnion, collection, doc, getDocs, runTransaction } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

        // Firebase config
        const firebaseConfig = {
            /*Absolutely not.*/
        };

        // Initialize application 
        const firebase = initializeApp(firebaseConfig);
        const db = getFirestore(firebase);
        const storage = getStorage();

        // Defining variables
        const imageUpload = document.querySelector('#imageUpload');
        const uploadButton = document.querySelector('#uploadButton');
        const imagesContainer = document.querySelector('#imagesContainer');
        const commentInput = document.querySelector('#commentInput');
        const addComment = document.querySelector('#addComment');
        const commentContainer = document.querySelector("#commentContainer");


        // Upload Image
        uploadButton.addEventListener('click', async() => {
            try {
                const file = imageUpload.files[0]; // Get file
                const fileName = file.name; // Get file name
                const getStorageRef = ref(storage, 'images/' + fileName); // Path to where you want to save your image
                uploadBytes(getStorageRef, file); // Upload file to Cloud Storage
                const getStorageUrl = await getDownloadURL(getStorageRef); // Get download URL for the image
                await setDoc(doc(db, 'images/', fileName), { // Add document to Firebase Firestore
                    imageUrl: getStorageUrl, 
                    name: fileName
                })
                console.log("Image and data uploaded!"); // Confirmation that the data has been successfully uploaded
                displayImages(); // This will display the newly uploaded image.
            } catch (error) {
                console.log("Error uploading image: " + error); // Error handling, show error message if something goes wrong
            } 
        });

        async function displayImages() {
            imagesContainer.innerHTML = ''; // Clear current image container

            await getDocs(collection(db, 'images'))
            .then((snapshot) => { // Get document from Firebase Firestore
                snapshot.docs.forEach((doc) => { // Foreach - What will happen to each document 
                    const imageData = doc.data(); // Get image data. 
                    renderImage(doc.id, imageData.imageUrl, imageData.comments); // Call function to render Images with the data
                }) .then(() => {
                    console.log(`The images has been rendered.`); // Not needed, does not work
                }) .catch(() => { 
                    console.log("Error displaying/getting image: " + error);  // Error handling, show error message if something goes wrong.. always.
                })
            })
        }
        
        async function displayComments() {
            commentContainer.innerHTML = ''; // Clear current image container

            await getDocs(collection(db, 'comments'))
            .then((snapshot) => { // Get document from Firebase Firestore
                snapshot.docs.forEach((doc) => { // Foreach - What will happen to each document 
                    const commentData = doc.data();
                    renderComment(commentData.comments); // Call function to render Images with the data
                }) .then(() => {
                    console.log(`The comments has been rendered.`); // Not needed, does not work
                }) .catch(() => { 
                    console.log("Error displaying/getting comment: " + error);  // Error handling, show error message if something goes wrong.. always.
                })
            })
        }
        
        addComment.addEventListener('click', () => {
            const commentRef = collection(db, 'comments/');
            const commentText = document.querySelector("#commentInput").value;
            addDoc(commentRef, {
                comments: [commentText]
            })
        })
        
        // Render image
        function renderImage(imageId, imageUrl, comments) { 
            imagesContainer.innerHTML += 
            `
            <img src="${imageUrl}"> 
            `
        }

        function renderComment(comment) {
            commentContainer.innerHTML += 
            `
                <div>
                    Comment: ${comment}    
                </div>
            `
        }

        renderComment();
        displayImages();
    </script> 
</body>
</html>
